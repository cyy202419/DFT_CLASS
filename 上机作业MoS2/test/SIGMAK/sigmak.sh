#!/bin/bash/env bash
cat ~/Desktop/PAW/PBE/Mo_pv/POTCAR ~/Desktop/PAW/PBE/S/POTCAR > POTCAR
cat > POSCAR <<!
Mo1 S2
1.0
1.5920630411037595 -2.7575340760443292 0.0000000000000000
1.5920630411037595 2.7575340760443292 0.0000000000000000
0.0000000000000000 0.0000000000000000 17.3345999500000012
Mo S
1 2
direct
0.0000000000000000 0.0000000000000000 0.0000000000000000 Mo4+
0.3333333333333333 0.6666666666666666 0.0894929799999999 S2-
0.3333333333333333 0.6666666666666667 0.9105070200000001 S2-
!

for j in 0.01 0.02 0.05 0.1 0.2 0.3 0.4 0.5
do
cat > INCAR <<!
SYSTEM = MoS2
ENCUT = 500
ISTART = 0
ICHARG = 2
ISMEAR = 0
PREC = Accurate
LWAVE = .F.
LCHARG = .F.
NWRITE = 1
NCORE = 4
EDIFF = 1E-7
SIGMA = $j
!

for i in 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20
do
cat > KPOINTS <<!
Automatic mesh
0
Gamma
$i $i 1
0 0 0
!

echo "SIGMA = $j, KPOINTS = $i" ; time mpirun -np 2 vasp
E=$(grep "TOTEN" OUTCAR | tail -1 | awk '{printf "%12.9f \n", $5 }')
echo $j $i $E >> sigmak_energy.dat
done
done
